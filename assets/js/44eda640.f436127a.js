"use strict";(self.webpackChunkreplibyte=self.webpackChunkreplibyte||[]).push([[41],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=s(n),m=r,y=u["".concat(p,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(y,i(i({ref:t},c),{},{components:n})):a.createElement(y,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6616:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return p},default:function(){return m},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return d}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],l={title:"Container",sidebar_position:1},p="Deploy Replibyte as a container",s={unversionedId:"guides/deploy-replibyte/container",id:"guides/deploy-replibyte/container",title:"Container",description:"You are using Replibyte on your local machine to create and restore dumps, it's great, but now you might want to deploy it close to your production and development environments to automate the process. This step-by-step guide explains how to do it and share you best practices.",source:"@site/docs/guides/deploy-replibyte/container.md",sourceDirName:"guides/deploy-replibyte",slug:"/guides/deploy-replibyte/container",permalink:"/docs/guides/deploy-replibyte/container",editUrl:"https://github.com/Qovery/replibyte/tree/main/website/docs/guides/deploy-replibyte/container.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Container",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"IV. Delete a dump",permalink:"/docs/guides/delete-a-dump"},next:{title:"Qovery",permalink:"/docs/guides/deploy-replibyte/qovery"}},c={},d=[{value:"Run Replibyte container locally",id:"run-replibyte-container-locally",level:2},{value:"Download the official Replibyte image",id:"download-the-official-replibyte-image",level:3},{value:"Create Replibyte configuration file",id:"create-replibyte-configuration-file",level:3},{value:"Start the container",id:"start-the-container",level:3},{value:"Running in a cloud environment",id:"running-in-a-cloud-environment",level:2},{value:"Deploy with Qovery",id:"deploy-with-qovery",level:3},{value:"Self-hosted Deployment",id:"self-hosted-deployment",level:3},{value:"Parameters for production",id:"parameters-for-production",level:3},{value:"Parameters to seed development databases",id:"parameters-to-seed-development-databases",level:3}],u={toc:d};function m(e){var t=e.components,l=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"deploy-replibyte-as-a-container"},"Deploy Replibyte as a container"),(0,o.kt)("p",null,"You are using Replibyte on your local machine to ",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/create-a-dump"},"create")," and ",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/restore-a-dump"},"restore dumps"),", it's great, but now you might want to deploy it close to your production and development environments to automate the process. This step-by-step guide explains how to do it and share you best practices."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"for qovery users")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"To deploy with ",(0,o.kt)("a",{parentName:"p",href:"https://www.qovery.com"},"Qovery"),", follow ",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/deploy-replibyte/qovery"},"this guide")))),(0,o.kt)("p",null,"Here is a schema of what we are going to put in place."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"schema Replibyte",src:n(1584).Z,width:"1000",height:"475"})),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"In production:",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Replibyte periodically dump the production database and.."),(0,o.kt)("li",{parentName:"ol"},"upload a dump ",(0,o.kt)("strong",{parentName:"li"},"without the sensitive data")," on a S3 bucket."))),(0,o.kt)("li",{parentName:"ol"},"In development:",(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"Replibyte periodically restore the development database with the latest dump.")))),(0,o.kt)("p",null,"Let's go!"),(0,o.kt)("h2",{id:"run-replibyte-container-locally"},"Run Replibyte container locally"),(0,o.kt)("h3",{id:"download-the-official-replibyte-image"},"Download the official Replibyte image"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"docker pull ghcr.io/qovery/replibyte\n")),(0,o.kt)("p",null,"Check the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/qovery/replibyte/pkgs/container/replibyte"},"Github package")," for available tags (currently ",(0,o.kt)("inlineCode",{parentName:"p"},"latest")," and per git release tag)."),(0,o.kt)("p",null,":::"),(0,o.kt)("h3",{id:"create-replibyte-configuration-file"},"Create Replibyte configuration file"),(0,o.kt)("p",null,"I will take our final ",(0,o.kt)("inlineCode",{parentName:"p"},"conf.yaml")," file from the ",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/create-a-dump"},'"create a dump"')," guide and rename it into ",(0,o.kt)("inlineCode",{parentName:"p"},"replibyte.yaml"),"."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"You must name your replibyte configuration file ",(0,o.kt)("inlineCode",{parentName:"p"},"replibyte.yaml"),". Otherwise, it will not work."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="replibyte.yaml"',title:'"replibyte.yaml"'},"encryption_key: $ENCRYPTION_SECRET # put a secure secret here\nsource:\n  connection_uri: $SOURCE_CONNECTION_URI\n  transformers:\n    - database: public\n      table: customers\n      columns:\n        - name: first_name\n          transformer_name: first-name\n        - name: last_name\n          transformer_name: random\n        - name: contact_phone\n          transformer_name: phone-number\n        - name: contact_email\n          transformer_name: email\ndatastore:\n  aws:\n    bucket: $S3_BUCKET\n    region: $S3_REGION\n    access_key_id: $S3_ACCESS_KEY_ID\n    secret_access_key: $S3_SECRET_ACCESS_KEY\ndestination:\n  connection_uri: $DESTINATION_CONNECTION_URI\n")),(0,o.kt)("p",null,"And set your environment variables in a file. You can leave secure environment variables empty so that they read from the shell environment."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"$ cat env.txt\nS3_ACCESS_KEY_ID\nS3_SECRET_ACCESS_KEY\nS3_REGION=us-east-2\nS3_BUCKET=my-test-bucket\nSOURCE_CONNECTION_URI=postgres://...\nDESTINATION_CONNECTION_URI=postgres://...\nENCRYPTION_SECRET\n")),(0,o.kt)("h3",{id:"start-the-container"},"Start the container"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'docker run -it --name replibyte \\\n    --env-file env.txt \\\n    -v "$(pwd)/replibyte.yaml":/replibyte.yaml:ro \\\n    ghcr.io/qovery/replibyte \\\n')),(0,o.kt)("h2",{id:"running-in-a-cloud-environment"},"Running in a cloud environment"),(0,o.kt)("h3",{id:"deploy-with-qovery"},"Deploy with Qovery"),(0,o.kt)("hr",null),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("a",{parentName:"p",href:"https://www.qovery.com"},"Qovery")," (the company behind Replibyte) is a platform used by more than 20 000 developers to deploy their apps on AWS in just a few seconds. Replibyte will be natively supported by Qovery in Q4 2022."))),(0,o.kt)("p",null,"To deploy Replibyte with Qovery - ",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/deploy-replibyte/qovery"},"here are the instructions"),"."),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"self-hosted-deployment"},"Self-hosted Deployment"),(0,o.kt)("p",null,"This part depends on the platform (E.g Kubernetes, Docker Swarm, Nomad...) you use to deploy your containers. Basically, you just need to pull the container and run it with the right parameters."),(0,o.kt)("h3",{id:"parameters-for-production"},"Parameters for production"),(0,o.kt)("p",null,"Here is the command line to dump the production"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -e S3_ACCESS_KEY_ID=XXX \\\n           -e S3_SECRET_ACCESS_KEY=YYY \\\n           -e S3_REGION=us-east-2 \\\n           -e S3_BUCKET=my-test-bucket \\\n           -e SOURCE_CONNECTION_URI=postgres://... \\\n           -e DESTINATION_CONNECTION_URI=postgres://... \\\n           -e ENCRYPTION_SECRET=itIsASecret \\\n           ghcr.io/qovery/replibyte replibyte dump create\n")),(0,o.kt)("h3",{id:"parameters-to-seed-development-databases"},"Parameters to seed development databases"),(0,o.kt)("p",null,"Here is the command line to seed your development database with the latest production dump"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -e S3_ACCESS_KEY_ID=XXX \\\n           -e S3_SECRET_ACCESS_KEY=YYY \\\n           -e S3_REGION=us-east-2 \\\n           -e S3_BUCKET=my-test-bucket \\\n           -e SOURCE_CONNECTION_URI=postgres://... \\\n           -e DESTINATION_CONNECTION_URI=postgres://... \\\n           -e ENCRYPTION_SECRET=itIsASecret \\\n           ghcr.io/qovery/replibyte replibyte dump restore remote -v latest\n")),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Do you have any questions? Feel free to join the channel #replibyte on ",(0,o.kt)("a",{parentName:"p",href:"https://discord.qovery.com"},"our Discord server"),"."))}m.isMDXComponent=!0},1584:function(e,t,n){t.Z=n.p+"assets/images/replibyte_dump_and_restore-cfbe738c4397d5baf43b3fcba299c17a.jpg"}}]);